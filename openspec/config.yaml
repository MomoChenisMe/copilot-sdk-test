schema: spec-driven

context: |
  ## Project
  綠地專案 — Telegram Copilot AI Agent
  透過 Telegram Bot 操控的私人 AI Agent，使用 GitHub Copilot SDK 驅動。

  ## Mandatory Constraint: TDD
  強制 TDD（測試驅動開發）：紅燈 → 綠燈 → 重構，無例外。
  任何功能實作前必須先撰寫對應測試。

  ## Tech Stack
  - TypeScript 5.7+, Node.js v24+ (ESM modules)
  - @github/copilot-sdk 0.1.8 (Technical Preview)
  - grammY 1.35+ (Telegram Bot framework)
  - @grammyjs/parse-mode (HTML parse mode plugin)
  - zod 3.24+ (runtime validation)
  - pino 9.6+ (structured JSON logging)
  - dotenv 16.4+ (environment variable management)
  - Build/Run: tsx (esbuild-based TypeScript execution)
  - Test: Vitest
  - Lint: ESLint + Prettier

  ### Project Structure
  - `src/bot/` — Telegram Bot 層（grammY 設定、middleware、指令、訊息路由）
  - `src/copilot/` — Copilot SDK 整合層（Client、Session 管理、處理器、工具）
  - `src/telegram/` — Telegram 輸出層（Markdown→HTML 格式化、分段發送）
  - `src/utils/` — 工具模組（logger、graceful shutdown）
  - `systemd/` — Linux 部署設定

  ## Conventions
  - ESM modules（"type": "module"）
  - Strict TypeScript（strict: true）
  - 分層架構：bot/ copilot/ telegram/ utils/ 各自負責獨立關注點
  - Conventional Commits
  - HTML parse mode for Telegram（非 MarkdownV2）
  - Long Polling 模式（非 Webhook）
  - 私人使用：白名單認證、權限自動批准

rules:
  proposal:
    - 使用繁體中文撰寫，技術術語保留英文原名
    - 必須說明功能的目標使用者和使用情境
    - 必須包含「非目標 (Non-Goals)」段落，明確排除不在範圍內的事項
  specs:
    - 使用繁體中文撰寫，技術術語保留英文原名
    - 使用 WHEN/THEN 格式撰寫場景
    - 必須涵蓋正常流程和異常流程
    - 每個需求必須是可測試的（可直接對應到測試案例）
    - 使用 SHALL/MUST 表達規範性需求
  design:
    - 使用繁體中文撰寫，技術術語保留英文原名
    - 每個技術決策必須列出至少一個替代方案及其取捨
    - 必須包含風險與緩解策略
  tasks:
    - 使用繁體中文撰寫，技術術語保留英文原名
    - 嚴格遵循 TDD 順序：先寫測試 → 再實作 → 最後重構，禁止先實作後補測試
    - 格式範例：「1.1 撰寫 XXX 測試」→「1.2 實作 XXX 功能」→「1.3 重構 XXX」
    - 每個階段結束須包含編譯或測試驗證步驟
